<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THPT Lộc An</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div id="login-section" class="min-vh-100 d-flex justify-content-center align-items-center">
        <div class="card shadow-lg p-4 text-center login-card">
            <div class="mb-4">
                <i class="fas fa-shield-alt fa-3x text-primary gradient-icon"></i>
            </div>
            <h3 class="fw-bold mb-2">Cổng Thông Tin Lớp</h3>
            <p class="text-muted small mb-4">Nhập mật khẩu chung để truy cập</p>
            
            <div class="form-floating mb-3">
                <input type="password" class="form-control" id="passwordInput" placeholder="Mật khẩu">
                <label for="passwordInput"><i class="fas fa-key me-2"></i>Mật khẩu</label>
            </div>
            
            <button onclick="checkPassword()" class="btn btn-primary btn-lg w-100 gradient-btn">
                Truy cập ngay <i class="fas fa-arrow-right ms-2"></i>
            </button>
            
            <p id="error-msg" class="text-danger mt-3 small fw-bold" style="display:none;">
                <i class="fas fa-exclamation-circle me-1"></i> Sai mật khẩu rồi!
            </p>
        </div>
    </div>

    <div id="main-section" class="d-none fade-in dashboard-wrapper p-4">
        <div class="row h-100">
            
            <div class="col-lg-9 col-md-12 mb-4">
                
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2 class="fw-bold text-dark mb-0">THPT Lộc An</h2>
                    <div class="search-bar bg-white p-2 rounded-pill shadow-sm d-flex align-items-center" style="width: 300px;">
                        <i class="fas fa-search text-muted ms-3 me-2"></i>
                        <input type="text" id="searchInput" class="form-control border-0 bg-transparent shadow-none" placeholder="Tìm kiếm tài liệu...">
                    </div>
                </div>

                <div id="search-results" class="d-none mb-5">
                    </div>

                <div id="home-content">
                    <h5 class="fw-bold text-dark mb-3">Môn Học</h5>
                    
                    <div class="row row-cols-2 row-cols-md-4 g-4 mb-5 justify-content-center">
                        <div class="col">
                            <div class="card cat-card bg-math text-white h-100" onclick="moMonHoc('Toán')">
                                <div class="card-body d-flex flex-column justify-content-center align-items-center">
                                    <i class="fas fa-calculator fa-2x mb-3 bg-white bg-opacity-25 p-3 rounded-circle icon-box"></i>
                                    <h5 class="fw-bold mb-1">Toán Học</h5>
                                </div>
                            </div>
                        </div>

                        <div class="col">
                            <div class="card cat-card bg-phys text-white h-100" onclick="moMonHoc('Lý')">
                                <div class="card-body d-flex flex-column justify-content-center align-items-center">
                                    <i class="fas fa-atom fa-2x mb-3 bg-white bg-opacity-25 p-3 rounded-circle icon-box"></i>
                                    <h5 class="fw-bold mb-1">Vật Lý</h5>
                                </div>
                            </div>
                        </div>

                        <div class="col">
                            <div class="card cat-card bg-chem text-white h-100" onclick="moMonHoc('Hóa')">
                                <div class="card-body d-flex flex-column justify-content-center align-items-center">
                                    <i class="fas fa-flask fa-2x mb-3 bg-white bg-opacity-25 p-3 rounded-circle icon-box"></i>
                                    <h5 class="fw-bold mb-1">Hóa Học</h5>
                                </div>
                            </div>
                        </div>

                        <div class="col">
                            <div class="card cat-card bg-eng text-white h-100" onclick="moMonHoc('Anh')">
                                <div class="card-body d-flex flex-column justify-content-center align-items-center">
                                    <i class="fas fa-language fa-2x mb-3 bg-white bg-opacity-25 p-3 rounded-circle icon-box"></i>
                                    <h5 class="fw-bold mb-1">Tiếng Anh</h5>
                                </div>
                            </div>
                        </div>

                        <div class="col">
                            <div class="card cat-card bg-bio text-white h-100" onclick="moMonHoc('Sinh')">
                                <div class="card-body d-flex flex-column justify-content-center align-items-center">
                                    <i class="fas fa-dna fa-2x mb-3 bg-white bg-opacity-25 p-3 rounded-circle icon-box"></i>
                                    <h5 class="fw-bold mb-1">Sinh Học</h5>
                                </div>
                            </div>
                        </div>

                        <div class="col">
                            <div class="card cat-card bg-hist text-white h-100" onclick="moMonHoc('Sử')">
                                <div class="card-body d-flex flex-column justify-content-center align-items-center">
                                    <i class="fas fa-landmark fa-2x mb-3 bg-white bg-opacity-25 p-3 rounded-circle icon-box"></i>
                                    <h5 class="fw-bold mb-1">Lịch Sử</h5>
                                </div>
                            </div>
                        </div>

                        <div class="col">
                            <div class="card cat-card bg-gdqp text-white h-100" onclick="moMonHoc('GDQP')">
                                <div class="card-body d-flex flex-column justify-content-center align-items-center">
                                    <i class="fas fa-shield-alt fa-2x mb-3 bg-white bg-opacity-25 p-3 rounded-circle icon-box"></i>
                                    <h5 class="fw-bold mb-1">GDQP</h5>
                                </div>
                            </div>
                        </div>
                    </div>
                </div> </div> <div class="col-lg-3 col-md-12">
                <div class="card border-0 shadow-sm rounded-4 text-center mb-4" style="background-color: #eef2ff;">
                    <a href="https://forms.gle/DsSC85Eonm5VHyAw8" target="_blank" style="text-decoration: none;">
                        <div class="card-body p-5" style="cursor: pointer;">
                            <i class="fas fa-cloud-upload-alt fa-3x text-primary mb-3"></i>
                            <h5 class="fw-bold text-primary">Thêm tài liệu mới</h5>
                            <small class="text-muted">Đóng góp tài liệu cho lớp tại đây</small>
                        </div>
                    </a>
                </div>
            </div> </div> 
    </div>


    <div id="subject-section" class="d-none fade-in min-vh-100 p-4" style="background-color: #f4f7fe;">
        <div class="container">
            
            <div class="d-flex align-items-center mb-5">
                <button onclick="quayLaiDashboard()" class="btn btn-white shadow-sm rounded-circle me-3" style="width: 50px; height: 50px;">
                    <i class="fas fa-arrow-left text-primary"></i>
                </button>
                <div>
                    <h2 id="subject-title" class="fw-bold mb-0">Môn Toán</h2>
                    <small class="text-muted">Chọn loại tài liệu bạn cần</small>
                </div>
            </div>

            <div class="row g-4 mb-5">
                <div class="col-md-6">
                    <div class="card border-0 shadow-sm rounded-4 overflow-hidden option-card" onclick="chonLoai('Lý thuyết')">
                        <div class="card-body p-5 d-flex align-items-center bg-white">
                            <div class="icon-box bg-primary bg-opacity-10 text-primary rounded-circle me-4" style="width: 80px; height: 80px;">
                                <i class="fas fa-book-open fa-2x"></i>
                            </div>
                            <div>
                                <h3 class="fw-bold mb-0">Lý Thuyết</h3> 
                            </div>
                            <i class="fas fa-chevron-right ms-auto text-muted"></i>
                        </div>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="card border-0 shadow-sm rounded-4 overflow-hidden option-card" onclick="chonLoai('Bài tập')">
                        <div class="card-body p-5 d-flex align-items-center bg-white">
                            <div class="icon-box bg-success bg-opacity-10 text-success rounded-circle me-4" style="width: 80px; height: 80px;">
                                <i class="fas fa-pen-nib fa-2x"></i>
                            </div>
                            <div>
                                <h3 class="fw-bold mb-0">Bài Tập</h3>
                            </div>
                            <i class="fas fa-chevron-right ms-auto text-muted"></i>
                        </div>
                    </div>
                </div>
            </div>

            <div id="list-container" class="d-none">
                <h4 class="fw-bold mb-3" id="list-title">Danh sách tài liệu</h4>
                <div id="file-list" class="list-group shadow-sm rounded-4 border-0">
                    </div>
            </div>

        </div>
    </div>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>

    <script>
        // LINK GOOGLE SHEET (Link bạn cung cấp)
        const SHEET_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRNHUHnb8bpDkIMyFOJ2RGhGIIthVDTALfpR6Blhsq1WAgLAlmwzHEmmXIsyJ-bxuejAmYTKjCHK1NY/pub?output=tsv'; 
        
        let monHocHienTai = "";
        let databaseTaiLieu = [];

        // 1. TẢI DỮ LIỆU
        function taiDuLieuTuSheet() {
            Papa.parse(SHEET_CSV_URL, {
                download: true,
                header: true,
                complete: function(results) {
                    databaseTaiLieu = results.data;
                    console.log("Đã tải xong dữ liệu:", databaseTaiLieu);
                },
                error: function(err) {
                    console.error("Lỗi tải dữ liệu:", err);
                }
            });
        }
        taiDuLieuTuSheet();

        // 2. CHECK PASSWORD
        function checkPassword() {
            const pass = document.getElementById('passwordInput').value;
            const errorMsg = document.getElementById('error-msg');
            
            errorMsg.style.display = 'none';
            if (!pass) { errorMsg.innerText = "Vui lòng nhập mật khẩu!"; errorMsg.style.display = 'block'; return; }
            
            const script = document.createElement('script');
            script.src = pass + ".js"; 
            script.onerror = function() {
                errorMsg.innerText = "Sai mật khẩu rồi! Thử lại nhé.";
                errorMsg.style.display = 'block';
            };
            document.head.appendChild(script);
        }

        // 3. ĐIỀU HƯỚNG
        function moMonHoc(tenMon) { 
            monHocHienTai = tenMon;
            document.getElementById('subject-title').innerText = "Môn " + tenMon;
            document.getElementById('main-section').classList.add('d-none');
            document.getElementById('subject-section').classList.remove('d-none');
            document.getElementById('list-container').classList.add('d-none');
        }

        function quayLaiDashboard() {
            document.getElementById('subject-section').classList.add('d-none');
            document.getElementById('main-section').classList.remove('d-none');
        }

        // 4. HIỂN THỊ DANH SÁCH
        function chonLoai(loai) {
            const container = document.getElementById('list-container');
            const title = document.getElementById('list-title');
            const listHtml = document.getElementById('file-list');
            
            container.classList.remove('d-none');
            title.innerText = "Danh sách " + loai + " (" + monHocHienTai + ")";
            listHtml.innerHTML = "";

            const ketQuaLoc = databaseTaiLieu.filter(item => {
                return item.Mon === monHocHienTai && item.Loai === loai && item.TrangThai === "OK";
            });

            if (ketQuaLoc.length === 0) {
                listHtml.innerHTML = `<div class="text-center p-4 text-muted">Chưa có tài liệu nào ở mục này.</div>`;
            } else {
                ketQuaLoc.forEach(bai => {
                    const icon = layIconTheoFile(bai.Link);
                    const html = `
                        <a href="${bai.Link}" target="_blank" class="list-group-item list-group-item-action p-3 d-flex align-items-center border-0 mb-2 rounded shadow-sm" style="background: white;">
                            <div class="me-3">${icon}</div>
                            <div class="flex-grow-1">
                                <h6 class="mb-0 fw-bold text-dark">${bai.TenTaiLieu}</h6>
                                <small class="text-muted"><i class="far fa-clock me-1"></i>${bai.ThoiGian || 'Mới cập nhật'}</small>
                            </div>
                            <span class="badge bg-primary bg-opacity-10 text-primary rounded-pill px-3 py-2">Mở file <i class="fas fa-external-link-alt ms-1"></i></span>
                        </a>
                    `;
                    listHtml.innerHTML += html;
                });
            }
            container.scrollIntoView({behavior: "smooth"});
        }

        // 5. CHỨC NĂNG TÌM KIẾM (MỚI THÊM)
        const searchInput = document.getElementById('searchInput');
        const searchResults = document.getElementById('search-results');
        const homeContent = document.getElementById('home-content');

        if(searchInput) {
            searchInput.addEventListener('input', function(e) {
                const keyword = e.target.value.toLowerCase().trim();
                
                // Nếu ô tìm kiếm trống -> Hiện lại trang chủ, Ẩn kết quả
                if (keyword === "") {
                    homeContent.classList.remove('d-none');
                    searchResults.classList.add('d-none');
                    searchResults.innerHTML = "";
                    return;
                }

                // Nếu có chữ -> Ẩn trang chủ, Hiện kết quả
                homeContent.classList.add('d-none');
                searchResults.classList.remove('d-none');

                // Lọc dữ liệu (Chỉ lấy bài OK)
                const ketQua = databaseTaiLieu.filter(item => {
                    // Tìm theo tên tài liệu HOẶC môn học
                    return item.TrangThai === "OK" && (
                        (item.TenTaiLieu && item.TenTaiLieu.toLowerCase().includes(keyword)) ||
                        (item.Mon && item.Mon.toLowerCase().includes(keyword))
                    );
                });

                if (ketQua.length === 0) {
                    searchResults.innerHTML = `
                        <div class="text-center p-5 text-muted">
                            <i class="fas fa-search fa-3x mb-3 text-secondary opacity-25"></i>
                            <p>Không tìm thấy tài liệu nào với từ khóa "<strong>${keyword}</strong>"</p>
                        </div>`;
                } else {
                    let html = `<h5 class="fw-bold text-dark mb-3">Kết quả tìm kiếm (${ketQua.length})</h5>
                                <div class="list-group shadow-sm rounded-4 border-0">`;
                    
                    ketQua.forEach(bai => {
                        const icon = layIconTheoFile(bai.Link);
                        html += `
                            <a href="${bai.Link}" target="_blank" class="list-group-item list-group-item-action p-3 d-flex align-items-center border-0 mb-1 rounded bg-white">
                                <div class="me-3">${icon}</div>
                                <div class="flex-grow-1">
                                    <h6 class="mb-0 fw-bold text-dark">${bai.TenTaiLieu}</h6>
                                    <small class="text-muted">${bai.Mon} • ${bai.Loai}</small>
                                </div>
                                <i class="fas fa-external-link-alt text-muted ms-2"></i>
                            </a>
                        `;
                    });
                    
                    html += `</div>`;
                    searchResults.innerHTML = html;
                }
            });
        }

        function layIconTheoFile(link) {
            if (!link) return '<i class="fas fa-file text-muted fa-2x"></i>';
            if (link.includes("spreadsheet") || link.includes("sheet")) return '<i class="fas fa-file-excel fa-2x text-success"></i>';
            if (link.includes("document") || link.includes("docs")) return '<i class="fas fa-file-word fa-2x text-primary"></i>';
            if (link.includes("presentation") || link.includes("slide")) return '<i class="fas fa-file-powerpoint fa-2x text-warning"></i>';
            return '<i class="fas fa-file-pdf fa-2x text-danger"></i>'; 
        }

        document.getElementById('passwordInput').addEventListener('input', function() { 
            document.getElementById('error-msg').style.display = 'none'; 
        });
    </script>
</body>
</html>